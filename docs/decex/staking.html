<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-decex/staking" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.1.1">
<title data-rh="true">Staking | Subspace Protocol</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://subspace.github.io/protocol-specs/docs/decex/staking"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Staking | Subspace Protocol"><meta data-rh="true" name="description" content="Staking sub-protocols."><meta data-rh="true" property="og:description" content="Staking sub-protocols."><meta data-rh="true" name="keywords" content="execution,decex,staking,deposit,withdraw,unlock"><link data-rh="true" rel="icon" href="/protocol-specs/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://subspace.github.io/protocol-specs/docs/decex/staking"><link data-rh="true" rel="alternate" href="https://subspace.github.io/protocol-specs/docs/decex/staking" hreflang="en"><link data-rh="true" rel="alternate" href="https://subspace.github.io/protocol-specs/docs/decex/staking" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://DQOBF9R1M4-dsn.algolia.net" crossorigin="anonymous"><link rel="search" type="application/opensearchdescription+xml" title="Subspace Protocol" href="/protocol-specs/opensearch.xml">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css" integrity="sha384-odtC+0UGzzFL/6PNoE8rX/SPcQDXBJ+uRepguP4QkPCm2LBxH3FA3y+fKSiJ+AmM" crossorigin="anonymous"><link rel="stylesheet" href="/protocol-specs/assets/css/styles.006e31aa.css">
<script src="/protocol-specs/assets/js/runtime~main.4baf4132.js" defer="defer"></script>
<script src="/protocol-specs/assets/js/main.10a979d7.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();null!==e?t(e):window.matchMedia("(prefers-color-scheme: dark)").matches?t("dark"):window.matchMedia("(prefers-color-scheme: light)").matches?t("light"):t("dark")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/protocol-specs/"><div class="navbar__logo"><img src="/protocol-specs/img/logo-black.svg" alt="Subspace Labs Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/protocol-specs/img/logo-white.svg" alt="Subspace Labs Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/protocol-specs/docs/protocol_specifications">Specifications</a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Network Resources</a><ul class="dropdown__menu"><li><a href="https://explorer.subspace.network/" target="_blank" rel="noopener noreferrer" class="dropdown__link">Subspace Explorer<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://telemetry.subspace.network" target="_blank" rel="noopener noreferrer" class="dropdown__link">Subspace Telemetry<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://polkadot.js.org/apps/?rpc=wss%3A%2F%2Feu-1.gemini-2a.subspace.network%2Fws#/explorer" target="_blank" rel="noopener noreferrer" class="dropdown__link">PolkadotJS Portal<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="navbar__items navbar__items--right"><a href="https://docs.subspace.network" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Documentation<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://github.com/subspace" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently dark mode)" aria-label="Switch between dark and light mode (currently dark mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/protocol-specs/docs/protocol_specifications">Protocol Specifications</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/protocol-specs/docs/crypto_primitives">Cryptographic Primitives</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/protocol-specs/docs/category/consensus">Consensus</a><button aria-label="Expand sidebar category &#x27;Consensus&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/protocol-specs/docs/category/decoupled-execution">Decoupled Execution</a><button aria-label="Collapse sidebar category &#x27;Decoupled Execution&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/protocol-specs/docs/decex/overview">Domains Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/protocol-specs/docs/decex/interfaces">Domains Interfaces</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/protocol-specs/docs/decex/bundles_blocks">Bundles and Domain Blocks</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/protocol-specs/docs/decex/workflow">Workflow</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/protocol-specs/docs/decex/staking">Staking</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/protocol-specs/docs/decex/fraud_proofs">Fraud Proofs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/protocol-specs/docs/decex/xdm">Cross-Domain Messaging (XDM)</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/protocol-specs/docs/category/fees-and-rewards">Fees and Rewards</a><button aria-label="Expand sidebar category &#x27;Fees and Rewards&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/protocol-specs/docs/runtime">Runtime</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/protocol-specs/docs/glossary">Glossary</a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/protocol-specs/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/protocol-specs/docs/category/decoupled-execution"><span itemprop="name">Decoupled Execution</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Staking</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Staking</h1></header><p>While the below scheme is different from traditional checkpointed or snapshotted staking protocols, it has the benefit being more efficient while consuming far less state. Specifically the state is constant in the number of operators and nominators. Most of the time, we only adjust the <code>current_epoch_fees</code> for an operator pool every time fees from confirmed blocks are collected (which is frequent).</p>
<p>Individual nominator shares for a given pool are independent of other nominators shares. Nominators shares only have to be updated when a deposit or withdrawal is made, which are relatively infrequent (compared to bundle production).</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="operator-registration">Operator Registration<a href="#operator-registration" class="hash-link" aria-label="Direct link to Operator Registration" title="Direct link to Operator Registration">​</a></h2>
<p>Any user who has the <code>MinOperatorStake</code> and sufficient hardware for running an operator node may choose to register as an operator by calling the <code>register_operator</code> extrinsic on a specific domain.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="operator-config">Operator Config<a href="#operator-config" class="hash-link" aria-label="Direct link to Operator Config" title="Direct link to Operator Config">​</a></h3>
<p>The settings for nominators, which include:</p>
<ul>
<li><code>nomination_tax</code>: the tax rate for compute fees earned by the pool (e.g. 5%).</li>
<li><code>minimum_nominator_stake</code>: the minimum stake needed to participate as a nominator for this pool. Should be &gt; 1 SSC.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="steps">Steps<a href="#steps" class="hash-link" aria-label="Direct link to Steps" title="Direct link to Steps">​</a></h3>
<ol>
<li>The operator must provide an <code>operator_config</code> and the following fields:<!-- -->
<ul>
<li><code>domain_id</code> of the target domain they wish to stake on</li>
<li><code>signing_key</code></li>
</ul>
</li>
<li>This immediately creates a new entry in the <code>Operators</code> registry, which creates a new staking pool for nominators to join. The pool is divided into shares on pro-rata basis, proportional to each nominators amount in the <code>current_total_stake</code>.</li>
<li>The deposit is applied to the <code>Deposits</code> storage for this operator as a pending deposit. The <code>operator_id</code> is also added to the <code>next_operators</code> set in the <code>DomainRegistry</code>.</li>
<li>A 20% of the deposit is transferred to a <code>storage_fund_account</code> towards paying storage fees for bundles. The rest of the deposit amount remains locked in operator’s balance account.</li>
<li>At the next epoch transition for this domain, the <code>current_total_stake</code> for this domain is updated to reflect the operator’s deposit (minus the storage fund %). The <code>operator_id</code> is moved to the <code>current_operators</code> for this domain.</li>
<li>The operator will get shares equal to their deposit (the <code>share_price</code> at the pool start is equal to <code>1</code>). The <code>total_shares</code> and <code>current_total_stake</code> are set to the staked value. Their initial pending deposit is moved to <code>KnownDeposit</code>.</li>
<li>The operator may now participate in the VRF bundle election.</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="nominator-registration">Nominator Registration<a href="#nominator-registration" class="hash-link" aria-label="Direct link to Nominator Registration" title="Direct link to Nominator Registration">​</a></h2>
<p>Any user who has <code>MinNominatorStake</code> may choose to join this operator’s pool by calling the <code>nominate_operator</code> <a href="/protocol-specs/docs/decex/interfaces#nominate_operator">extrinsic</a> with the <code>deposit_amount</code> of SSC they wish to stake.</p>
<p>Note: the actual calculations are done in Shannons, and 1 SSC = <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><msup><mn>0</mn><mn>18</mn></msup></mrow><annotation encoding="application/x-tex">10^{18}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141em"></span><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em"><span style="top:-3.063em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">18</span></span></span></span></span></span></span></span></span></span></span></span> Shannons</p>
<p>First nomination:</p>
<ol>
<li>The deposit of <code>deposit_amount</code> SSC is added to the <code>Deposits</code> storage as a <code>PendingDeposit</code> for the operator pool they chose.</li>
<li>A 20% of the deposit is transferred to a <code>storage_fund_account</code> towards paying storage fees for bundles. The rest of the deposit amount remains locked in operator’s balance account.</li>
<li>Deposit <code>deposit_amount</code>(minus the 20% for storage fund) is locked for <code>nominator_id</code> account in <code>pallet_balances</code> and <code>operator_id</code>’s <code>deposits_in_epoch</code> is incremented by the same amount.</li>
<li>During the next epoch transition, the <code>deposit_amount</code> is added to <code>current_total_stake</code> of the operator pool and domain’s <code>current_total_stake</code>.</li>
</ol>
<p>Note that nominator shares are not yet “assigned” until they either add a new deposit in a subsequent epoch or initiate a withdrawal.</p>
<p>For subsequent nomination deposits see <a href="#stake-deposits">Stake Deposits</a>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="stake-withdrawals">Stake Withdrawals<a href="#stake-withdrawals" class="hash-link" aria-label="Direct link to Stake Withdrawals" title="Direct link to Stake Withdrawals">​</a></h2>
<p>Any registered operator or nominator may initiate a withdrawal of their stake from the pool by submitting a <code>withdraw_stake</code> <a href="/protocol-specs/docs/decex/interfaces#withdraw_stake">extrinsic</a> which support different types of withdrawal:</p>
<ul>
<li>All, withdraw all the stake</li>
<li>Percent, withdraw a given percentage of the stake</li>
<li>Stake, withdraw a given amount of stake (i.e. balance)
The stake is calculated by the share price at this instant, it may not be accurate and may withdraw a bit more stake if there is reward happen later in this epoch</li>
<li>Share, withdraw a given amount of share</li>
</ul>
<p>If the nominator&#x27;s stake after withdrawal results in an amount below the operator&#x27;s required <code>minimum_nominator_stake,</code> the nominator is automatically completely unstaked. Contrary, the operator cannot withdraw below the <code>MinOperatorStake</code>.</p>
<p>A withdrawal is logically composed of 2 parts. First, a user request to withdraw shares (<code>withdraw_stake</code>) that unstakes a given amount of stake at the end of epoch, and second, a request to unlock (<code>unlock_funds</code> <a href="/protocol-specs/docs/decex/interfaces#unlock_funds">extrinsic</a>) and actually transfer to the balance account the amount of SSC for those shares after the locking period has passed.</p>
<p>A nominator can submit <code>withdraw_stake</code> extrinsics to request withdrawal. Withdrawals requested in the same epoch are aggregated into one, and there are at most <code>WithdrawalLimit</code> number of withdrawal allowed for a given nominator at the same time, once this limit is reached, the nominator need to submit <code>unlock_funds</code> extrinsic to unlock the withdrawal before requesting a new one.</p>
<ol>
<li>Nominator submits a <code>withdraw_stake</code> extrinsic.</li>
<li>If there are any pending deposits <code>PendingDeposit</code> for this nominator for any previous epoch <code>n</code>, then use the <code>OperatorEpochSharePrice</code> stored for those specific deposit epoch <code>n</code> and calculate the <code>shares</code> and add it to existing <code>shares</code> in <code>KnownDeposit</code>.This would not be unbounded and at max be 1 <code>PendingDeposit</code> for a given nominator.</li>
<li>If there are any withdrawals <code>withdrawals_in_shares</code> for this nominator for any previous epoch <code>n</code>, then use the <code>OperatorEpochSharePrice</code> stored for those specific epoch <code>n</code> and convert the <code>shares</code> to SSC, move the withdrawal into the converted <code>withdrawals</code> vector and add the amount to <code>total_withdrawal_amount</code>.</li>
<li>Ensure the total number of withdrawals in the <code>withdrawals</code> vector is less than <code>WithdrawalLimit</code></li>
<li>Once the pending nominator deposit shares are calculated and added to known shares,<!-- -->
<ol>
<li>If there are no withdrawals initiated this epoch yet, a <code>Withdrawal</code> item is created with<!-- -->
<ol>
<li><code>allowed_since_domain_epoch</code> set to current epoch,</li>
<li><code>unlock_at_confirmed_domain_block_number = LatestConfirmedDomainBlockNumber(domain_id) + StakeWithdrawalLockingPeriod</code>,</li>
<li><code>withdraw_shares</code> requested,</li>
<li><code>storage_fee_refund = withdraw_shares/total_shares*storage_fee_deposit/total_storage_fee_deposit*storage_fund_account_balance</code></li>
</ol>
</li>
<li>If there is already a withdrawal for the same <code>allowed_since_domain_epoch</code>, <code>Withdrawal</code> storage is incremented with intended #<code>withdraw_shares</code> and <code>storage_fee_refund</code> to withdraw, and <code>unlock_at_confirmed_domain_block_number</code> is updated to a higher value <code>LatestConfirmedDomainBlockNumber(domain_id) + StakeWithdrawalLockingPeriod</code>. All the withdrawals submitted in the same epoch are unlocked at the unlocking time of the last withdrawal of that epoch.</li>
<li>Similar to <code>total_withdrawal_amount</code>, add <code>storage_fee_refund</code> to <code>total_storage_fee_withdrawal</code></li>
<li><code>Nominator</code> shares and storage fee deposit in their known deposits <code>KnownDeposit</code> are reduced:<!-- -->
<ol>
<li><code>shares = shares - withdraw_shares</code></li>
<li><code>storage_fee_deposit = storage_fee_deposit(1 - withdraw_shares/shares)</code></li>
</ol>
</li>
</ol>
</li>
<li><code>operator_id</code> ‘s <code>withdrawals_in_epoch</code> are incremented with total of <code>withdraw_shares</code> from all nominators withdraw requests for the next epoch.</li>
<li>The total of all nominator storage fee deposits (<code>total_storage_fee_deposit</code>) is decremented by <code>storage_fee_refund</code>.</li>
<li>The <code>storage_fee_refund</code> amount is locked in the operator’s <code>storage_fund_account</code> and not used to pay for any future bundles.</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="unlock-withdrawn-funds">Unlock withdrawn funds<a href="#unlock-withdrawn-funds" class="hash-link" aria-label="Direct link to Unlock withdrawn funds" title="Direct link to Unlock withdrawn funds">​</a></h3>
<p>Once the previous epoch (of <code>withdraw_shares</code> extrinsic) is completed and share price for that epoch is noted, nominators can withdraw the requested shares that had passed the unlocking period.</p>
<ol>
<li>Nominator submits <code>unlock_funds(operator_id, nominator_id)</code></li>
<li>Operator iterate the <code>nominator_id</code>&#x27;s withdrawal from the oldest to newest<!-- -->
<ol>
<li>If the withdrawal&#x27;s <code>StakeWithdrawalLockingPeriod</code> period is not complete (the <code>unlock_at_confirmed_domain_block_number</code> is higher than <code>LatestConfirmedDomainBlockNumber(domain_id)</code>), then stop iterating.</li>
<li>Remove the withdrawal from the the <code>withdrawals</code> vector</li>
<li>Calculate <code>amount_to_unlock</code> as SSC amount for withdrawn shares using share value for epoch stored at <code>OperatorEpochSharePrice</code> the withdraw is allowed from.</li>
<li>Add the <code>amount_to_unlock</code> to <code>total_amount_to_unlock</code> and the <code>storage_fee_refund</code> to <code>total_storage_fee_refund</code></li>
</ol>
</li>
<li>Deduct <code>total_amount_to_unlock</code> from <code>total_withdrawal_amount</code> and <code>total_storage_fee_refund</code> from <code>total_storage_fee_withdrawal</code></li>
<li>Release <code>total_storage_fee_refund</code> from locked to transferrable state for nominator account.</li>
<li>If <code>total_amount_to_unlock</code> is more than SSC amount that was locked for staking on this operator, the excess is minted and locked to nominator account.</li>
<li>Finally, <code>total_amount_to_unlock</code> of SSC is released from locked to transferrable state for nominator account.</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="stake-deposits">Stake Deposits<a href="#stake-deposits" class="hash-link" aria-label="Direct link to Stake Deposits" title="Direct link to Stake Deposits">​</a></h2>
<p>Existing nominators may choose to add more stake to the same operator’s pool they are already nominating using the same <code>nominate_operator</code> <a href="/protocol-specs/docs/decex/interfaces#nominate_operator">extrinsic</a> with the <code>deposit_amount</code> of SSC they wish to stake.</p>
<ol>
<li>Nominator with balance account <code>nominator_id</code> submits an extrinsic to deposit for next epoch for a given <code>OperatorPool</code> as <code>nominate_operator(OperatorPoolId, nominator_id, deposit_amount)</code></li>
<li>The <code>deposit_amount</code> is locked for  <code>nominator_id</code> account in <code>pallet_balances</code>.</li>
<li>The deposit is added as <code>PendingDeposit</code> to <code>Deposits</code> storage for this nominator-operator pair as a key.</li>
<li>If there is a pending deposit for this nominator submitted this epoch, the existing pending deposit is incremented with <code>deposit_amount</code>.</li>
<li>If there are any pending deposits for this nominator for any previous epoch <code>n</code>, then use the <code>OperatorEpochSharePrice</code> stored for those specific deposit epoch <code>n</code> and calculate the <code>shares</code> and add it to existing <code>shares</code> in <code>KnownDeposit</code>.This would not be unbounded and at max be 1 <code>PendingDeposit</code> for a given nominator.</li>
<li>A 20% of the deposit is transferred to a <code>storage_fund_account</code> towards paying storage fees for bundles. The rest of the deposit amount remains locked in nominator’s balance account.</li>
<li>The amount transferred is applied to domain’s balance.</li>
<li>The deposit of <code>deposit_amount</code>(minus the storage fund %) SSC is applied to the <code>deposits_in_epoch</code> table within the operator pool.</li>
<li>During the next epoch transition,<!-- -->
<ol>
<li>Compute the operator’s pool end-of-epoch <code>share_price</code> as the sum of all stake in the pool and rewards gained during the previous epoch divided by the total number of shares <code>(current_total_stake + current_epoch_rewards * (1-nomination_tax)) / total_shares</code>.</li>
<li>Assign the <code>shares</code> to this nominator based on the <code>share_price</code> of the pool (as <code>shares = deposit_amount / share_price</code>).</li>
<li>The <code>deposit_amount</code> is added to <code>current_total_stake</code> of the operator pool and domain’s <code>current_total_stake</code>.</li>
<li>The <code>shares</code> of this nominator are added to <code>total_shares</code> of the pool.</li>
</ol>
</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="operator-deregistration">Operator Deregistration<a href="#operator-deregistration" class="hash-link" aria-label="Direct link to Operator Deregistration" title="Direct link to Operator Deregistration">​</a></h2>
<p>See the corresponding <code>deregister_operator</code> <a href="/protocol-specs/docs/decex/interfaces#deregister_operator">extrinsic</a>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="slashing-stake">Slashing Stake<a href="#slashing-stake" class="hash-link" aria-label="Direct link to Slashing Stake" title="Direct link to Slashing Stake">​</a></h2>
<p>If any <code>submit_fraud_proof</code> <a href="/protocol-specs/docs/decex/interfaces#submit_fraud_proof">extrinsic</a> is accepted by the chain, the operator’s entire pool is slashed.</p>
<ol>
<li>The pool is immediately frozen for withdrawals and deposits, by setting <code>status</code> in <code>Operators</code> registry entry of this operator to <code>Slashed</code>.</li>
<li>All new deposits are canceled and returned to senders.</li>
<li>The <code>Withdrawals</code> table is checked to see if there are any withdrawals initiated for this operator, all of which are sent to the treasury account.</li>
<li>The entire operator pool balance of <code>current_total_stake</code> and any rewards received will be transferred to treasury account and operator is removed from the <code>next_operators</code>.</li>
<li>At epoch transition, the entire pool balance is applied to the SSC treasury account, and the Operator is removed from the <code>Operators</code> registry.</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="fees-distribution">Fees Distribution<a href="#fees-distribution" class="hash-link" aria-label="Direct link to Fees Distribution" title="Direct link to Fees Distribution">​</a></h2>
<p>For each confirmed domain block this domain, fees are distributed as follows:</p>
<ul>
<li>The storage fees (<code>ER::block_fees.storage_fee</code>) for bundles in that block are refunded to the operators who authored those bundles according to how much they front-paid for bundle size.</li>
<li>The execution fees (<code>ER::block_fees.execution_fee</code>) from the newly confirmed domain block are applied to the <code>current_epoch_fees</code> for this domain in the <code>DomainRegistry</code> and the operators pool (who submitted this ER) in the <code>Operators</code> registry.</li>
<li>Operator will get a cut of all fees collected by this pool as per <code>nomination_tax</code> specified in operator’s config at the epoch transition.</li>
<li>Operator’s cut will be automatically re-staked (via a deposit) to the operator’s nomination at next epoch transition. Operator’s <code>shares</code>, <code>total_shares</code> and <code>current_total_stake</code> will be updated with the corresponding deposit.</li>
<li>At the next epoch transition we check all domains and apply all changes corresponding to rewards, deposits and withdrawals to the <code>current_total_stake</code>, and the iterating through all registered operators and updating their <code>current_total_stake</code> as well. Note that this only changes the total pool balance, but does not affect <code>total_shares</code> or <code>shares</code> for any individual nominators.</li>
</ul>
<p>Note: because of the challenge period, the fees distribution is delayed, and as a result, the set of nominators in the operator pool may have changed in the meantime. New operators who joined after the newly confirmed block was produced will get fees share from the blocks produced before they joined. Nominators who withdraw some shares will get lesser fee share. Nominators who withdraw completely, do not get fees for the last blocks still in challenge period, even though they were staking when those blocks were produced.</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/protocol-specs/docs/decex/workflow"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Workflow</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/protocol-specs/docs/decex/fraud_proofs"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Fraud Proofs</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#operator-registration" class="table-of-contents__link toc-highlight">Operator Registration</a><ul><li><a href="#operator-config" class="table-of-contents__link toc-highlight">Operator Config</a></li><li><a href="#steps" class="table-of-contents__link toc-highlight">Steps</a></li></ul></li><li><a href="#nominator-registration" class="table-of-contents__link toc-highlight">Nominator Registration</a></li><li><a href="#stake-withdrawals" class="table-of-contents__link toc-highlight">Stake Withdrawals</a><ul><li><a href="#unlock-withdrawn-funds" class="table-of-contents__link toc-highlight">Unlock withdrawn funds</a></li></ul></li><li><a href="#stake-deposits" class="table-of-contents__link toc-highlight">Stake Deposits</a></li><li><a href="#operator-deregistration" class="table-of-contents__link toc-highlight">Operator Deregistration</a></li><li><a href="#slashing-stake" class="table-of-contents__link toc-highlight">Slashing Stake</a></li><li><a href="#fees-distribution" class="table-of-contents__link toc-highlight">Fees Distribution</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Subspace Network</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://subspace.network" target="_blank" rel="noopener noreferrer" class="footer__link-item">Official Website<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/subspace/subspace-desktop" target="_blank" rel="noopener noreferrer" class="footer__link-item">Subspace Desktop<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://polkadot.js.org/apps/?rpc=wss%3A%2F%2Ftest-rpc.subspace.network#/explorer" target="_blank" rel="noopener noreferrer" class="footer__link-item">Subspace Explorer<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://testnet-relayer.subspace.network/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Subspace Relayer<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/subspace" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discord.gg/subspace-network" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://t.me/subspace_network" target="_blank" rel="noopener noreferrer" class="footer__link-item">Telegram<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Social</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.youtube.com/channel/UCojYRCZOtVTJHJXivOYJzeQ" target="_blank" rel="noopener noreferrer" class="footer__link-item">YouTube<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.linkedin.com/company/subspace-blockchain" target="_blank" rel="noopener noreferrer" class="footer__link-item">LinkedIn<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/network_subspace" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://medium.com/subspace-network" target="_blank" rel="noopener noreferrer" class="footer__link-item">Medium<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://app.subsocial.network/@NetworkSubspace" target="_blank" rel="noopener noreferrer" class="footer__link-item">Subsocial<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://subspace.network" rel="noopener noreferrer" class="footerLogoLink_BH7S"><img src="/protocol-specs/img/banner-black.svg" alt="Subspace Labs Banner Logo" class="footer__logo themedComponent_mlkZ themedComponent--light_NVdE"><img src="/protocol-specs/img/banner-white.svg" alt="Subspace Labs Banner Logo" class="footer__logo themedComponent_mlkZ themedComponent--dark_xIcU"></a></div><div class="footer__copyright">Copyright © 2024 Subspace Labs, Inc.</div></div></div></footer></div>
</body>
</html>