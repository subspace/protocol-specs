<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-consensus/proof_of_archival_storage" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.1.1">
<title data-rh="true">Proof-of-Archival-Storage | Subspace Protocol</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://subspace.github.io/protocol-specs/docs/consensus/proof_of_archival_storage"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Proof-of-Archival-Storage | Subspace Protocol"><meta data-rh="true" name="description" content="Proof-of-Archival-Storage Dilithium Consensus"><meta data-rh="true" property="og:description" content="Proof-of-Archival-Storage Dilithium Consensus"><meta data-rh="true" name="keywords" content="archiving,farming,plotting,auditing"><link data-rh="true" rel="icon" href="/protocol-specs/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://subspace.github.io/protocol-specs/docs/consensus/proof_of_archival_storage"><link data-rh="true" rel="alternate" href="https://subspace.github.io/protocol-specs/docs/consensus/proof_of_archival_storage" hreflang="en"><link data-rh="true" rel="alternate" href="https://subspace.github.io/protocol-specs/docs/consensus/proof_of_archival_storage" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://DQOBF9R1M4-dsn.algolia.net" crossorigin="anonymous"><link rel="search" type="application/opensearchdescription+xml" title="Subspace Protocol" href="/protocol-specs/opensearch.xml">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css" integrity="sha384-odtC+0UGzzFL/6PNoE8rX/SPcQDXBJ+uRepguP4QkPCm2LBxH3FA3y+fKSiJ+AmM" crossorigin="anonymous"><link rel="stylesheet" href="/protocol-specs/assets/css/styles.006e31aa.css">
<script src="/protocol-specs/assets/js/runtime~main.504029dd.js" defer="defer"></script>
<script src="/protocol-specs/assets/js/main.315ffdb1.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();null!==e?t(e):window.matchMedia("(prefers-color-scheme: dark)").matches?t("dark"):window.matchMedia("(prefers-color-scheme: light)").matches?t("light"):t("dark")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/protocol-specs/"><div class="navbar__logo"><img src="/protocol-specs/img/logo-black.svg" alt="Subspace Labs Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/protocol-specs/img/logo-white.svg" alt="Subspace Labs Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/protocol-specs/docs/protocol_specifications">Specifications</a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Network Resources</a><ul class="dropdown__menu"><li><a href="https://explorer.subspace.network/" target="_blank" rel="noopener noreferrer" class="dropdown__link">Subspace Explorer<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://telemetry.subspace.network" target="_blank" rel="noopener noreferrer" class="dropdown__link">Subspace Telemetry<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://polkadot.js.org/apps/?rpc=wss%3A%2F%2Feu-1.gemini-2a.subspace.network%2Fws#/explorer" target="_blank" rel="noopener noreferrer" class="dropdown__link">PolkadotJS Portal<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="navbar__items navbar__items--right"><a href="https://docs.subspace.network" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Documentation<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://github.com/subspace" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently dark mode)" aria-label="Switch between dark and light mode (currently dark mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/protocol-specs/docs/protocol_specifications">Protocol Specifications</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/protocol-specs/docs/crypto_primitives">Cryptographic Primitives</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/protocol-specs/docs/category/consensus">Consensus</a><button aria-label="Collapse sidebar category &#x27;Consensus&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/protocol-specs/docs/consensus/consensus_chain">Consensus Chain</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/protocol-specs/docs/consensus/proof_of_archival_storage">Proof-of-Archival-Storage</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/protocol-specs/docs/consensus/proof_of_space">Proof-of-Space</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/protocol-specs/docs/consensus/proof_of_time">Proof-of-Time</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/protocol-specs/docs/category/decoupled-execution">Decoupled Execution</a><button aria-label="Expand sidebar category &#x27;Decoupled Execution&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/protocol-specs/docs/category/fees-and-rewards">Fees and Rewards</a><button aria-label="Expand sidebar category &#x27;Fees and Rewards&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/protocol-specs/docs/runtime">Runtime</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/protocol-specs/docs/glossary">Glossary</a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/protocol-specs/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/protocol-specs/docs/category/consensus"><span itemprop="name">Consensus</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Proof-of-Archival-Storage</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Proof-of-Archival-Storage</h1></header><h2 class="anchor anchorWithStickyNavbar_LWe7" id="public-parameters-and-values">Public Parameters and Values<a href="#public-parameters-and-values" class="hash-link" aria-label="Direct link to Public Parameters and Values" title="Direct link to Public Parameters and Values">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="protocol-constants">Protocol Constants<a href="#protocol-constants" class="hash-link" aria-label="Direct link to Protocol Constants" title="Direct link to Protocol Constants">​</a></h3>
<p>These parameters are fixed at the beginning of the protocol and used by all clients.</p>
<ul>
<li>
<p><code>SLOT_PROBABILITY</code>: the probability of successful block in a slot (active slots coefficient), currently 1/6. This defines the expected block production rate of 1 block every 6 seconds</p>
</li>
<li>
<p><code>INITIAL_SOLUTION_RANGE</code>: solution range for proof-of-replication challenge for the first era</p>
</li>
<li>
<p><code>ERA_DURATION_IN_BLOCKS</code>: solution range is adjusted after this many blocks, currently 2016 (as in Bitcoin)</p>
</li>
<li>
<p><code>KZG_PUBLIC_PARAMETERS</code>: universal reference values for <a href="https://dankradfeist.de/ethereum/2020/06/16/kate-polynomial-commitments.html" target="_blank" rel="noopener noreferrer">KZG Polynomial Commitment scheme</a> obtained through an MPC <a href="https://ceremony.ethereum.org/" target="_blank" rel="noopener noreferrer">ceremony</a></p>
</li>
<li>
<p><code>KZG_MAX_DEGREE</code> is <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>2</mn><mn>15</mn></msup></mrow><annotation encoding="application/x-tex">2^{15}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141em"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em"><span style="top:-3.063em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">15</span></span></span></span></span></span></span></span></span></span></span></span>: the maximum degree of the polynomial possible to commit to under the KZG scheme</p>
</li>
<li>
<p><code>CONFIRMATION_DEPTH_K</code>: minimal depth after which a block can enter the recorded history (a global constant, as opposed to the client-dependent transaction confirmation depth), currently 100</p>
</li>
<li>
<p><code>EXPECTED_VOTES_PER_BLOCK</code>: number of votes expected per block, currently 9</p>
</li>
<li>
<p><code>SAFE_BYTES</code> is 31 bytes: the size into which raw history data is partitioned before Archiving for KZG commitment, required to ensure that values fit the size of the point subgroup of BLS12-381 curve</p>
</li>
<li>
<p><code>FULL_BYTES</code> is 32 bytes: the size into which encoded data is partitioned after Archiving</p>
</li>
<li>
<p><code>NUM_CHUNKS</code> is <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>2</mn><mn>15</mn></msup></mrow><annotation encoding="application/x-tex">2^{15}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141em"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em"><span style="top:-3.063em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">15</span></span></span></span></span></span></span></span></span></span></span></span>: number of KZG field elements that compose a record, <code>NUM_CHUNKS</code> ≤ <code>KZG_MAX_DEGREE</code>.</p>
</li>
<li>
<p><code>NUM_S_BUCKETS</code>: number of s-buckets in a record (and by extension in plot sector), currently <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>2</mn><mn>16</mn></msup></mrow><annotation encoding="application/x-tex">2^{16}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141em"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em"><span style="top:-3.063em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">16</span></span></span></span></span></span></span></span></span></span></span></span> (<code>NUM_CHUNKS / ERASURE_CODING_RATE</code>)</p>
</li>
<li>
<p><code>RAW_RECORD_SIZE</code> is <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>⪅</mo></mrow><annotation encoding="application/x-tex">\lessapprox</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0117em;vertical-align:-0.2558em"></span><span class="mrel amsrm">⪅</span></span></span></span> 1 MiB: the size of a record of raw blockchain history before Archiving to be transformed into a piece (<code>SAFE_BYTES * NUM_CHUNKS = 1015808 b</code>)</p>
</li>
<li>
<p><code>NUM_RAW_RECORDS</code> is 128: the number of raw records in a Recorded History Segment</p>
</li>
<li>
<p><code>RECORDED_HISTORY_SEGMENT_SIZE</code> is roughly 128 MiB: size of raw recorded history segment ready for Archiving (<code>RAW_RECORD_SIZE * NUM_RAW_RECORDS</code>)</p>
</li>
<li>
<p><code>RECORD_SIZE</code> is 1 MiB: the size of useful data in one piece (<code>FULL_BYTES * NUM_CHUNKS = 1048576 b</code>)</p>
</li>
<li>
<p><code>WITNESS_SIZE</code> is 48 bytes: the size of KZG witness</p>
</li>
<li>
<p><code>COMMITMENT_SIZE</code> is 48 bytes: the size of KZG commitment</p>
</li>
<li>
<p><code>PIECE_SIZE</code> is  <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>⪆</mo></mrow><annotation encoding="application/x-tex">\gtrapprox</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0117em;vertical-align:-0.2558em"></span><span class="mrel amsrm">⪆</span></span></span></span> 1 MiB: a piece of blockchain history (<code>RECORD_SIZE + COMMITMENT_SIZE + WITNESS_SIZE = 1048672 b</code>)</p>
<div class="collapsible"><button class="collapsible-toggle">►<!-- --> <!-- -->Implementation Note</button><div class="collapsible-content"><p>In a piece, the chunks should be full 32 bytes, because after performing field operations (i.e. erasure coding) the resulting field elements are not guaranteed to fit into 31 bytes anymore.</p></div></div>
</li>
<li>
<p><code>ERASURE_CODING_RATE</code>: parameter of erasure code operation, specifies what portion of data is enough to recover it fully in case of loss, currently 1/2</p>
</li>
<li>
<p><code>NUM_PIECES</code> is 256: the number of pieces in an Archived History Segment after erasure coding (<code>NUM_RAW_RECORDS/ERASURE_CODING_RATE</code>)</p>
</li>
<li>
<p><code>K</code>: space parameter (memory hardness) for <em>proof-of-space</em>, currently 20</p>
</li>
<li>
<p><code>RECENT_SEGMENTS</code>: number of latest archived segments that are considered Recent History for the purposes of Plotting (currently 3)</p>
</li>
<li>
<p><code>RECENT_HISTORY_FRACTION</code>: fraction of recently archived pieces from the <code>RECENT_SEGMENTS</code> in each sector (currently 1/10)</p>
</li>
<li>
<p><code>MIN_SECTOR_LIFETIME</code>: minimum lifetime of a plotted sector, measured in archived segments, currently 4</p>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="dynamic-blockchain-values">Dynamic Blockchain Values<a href="#dynamic-blockchain-values" class="hash-link" aria-label="Direct link to Dynamic Blockchain Values" title="Direct link to Dynamic Blockchain Values">​</a></h3>
<p>These parameters are derived from the blockchain and are dynamically updated over time.</p>
<ul>
<li><code>slot_number</code>: current slot number, derived since genesis from the <a href="/protocol-specs/docs/consensus/proof_of_time">Proof-of-Time</a> chain</li>
<li><code>solution_range</code>: farming difficulty parameter, dynamically adjusted to control the block generation rate</li>
<li><code>voting_solution_range</code>: voting difficulty parameter, dynamically adjusted to control the vote generation rate. This range is larger than <code>solution_range</code> to allow for multiple votes per block (<code>solution_range * (EXPECTED_VOTES_PER_BLOCK+1)</code>)</li>
<li><code>global_randomness</code>: used to derive slot challenges, from the <a href="/protocol-specs/docs/consensus/proof_of_time">Proof-of-Time</a> chain</li>
<li><code>pieces[]</code>: all pieces of the recorded blockchain history</li>
<li><code>history_size</code>: number of archived segments of the blockchain history until this moment</li>
<li><code>segment_commitments[]</code>: hash map of KZG commitments computed over pieces in a segment and stored in the runtime</li>
<li><code>BlockList</code>: list of public keys that committed offenses</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="consensus-parameters">Consensus Parameters<a href="#consensus-parameters" class="hash-link" aria-label="Direct link to Consensus Parameters" title="Direct link to Consensus Parameters">​</a></h3>
<p>These parameters are fixed at the beginning of the protocol and used by all clients, however they can be updated if necessary.</p>
<ul>
<li><code>max_pieces_in_sector</code>: number of pieces to be retrieved from blockchain history by a farmer under Verifiable Sector Construction (VSC) and encoded in a single sector by an honest farmer, currently 1000</li>
<li><code>sector_size</code>: size of a plotted sector on disk, currently ~1 GiB (<code>max_pieces_in_sector * RECORD_SIZE</code>)</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="archiving">Archiving<a href="#archiving" class="hash-link" aria-label="Direct link to Archiving" title="Direct link to Archiving">​</a></h2>
<p><em><strong>Preparing the history</strong></em></p>
<ol>
<li>
<p>The genesis block is archived as soon as it produced.
We extend the encoding of the genesis block with extra pseudorandom data up to <code>RECORDED_HISTORY_SEGMENT_SIZE</code>, such that the very first archived segment can be produced right away, bootstrapping the farming process.
This extra data is added to the end of the <a href="https://docs.substrate.io/reference/scale-codec/" target="_blank" rel="noopener noreferrer">SCALE-encoded</a> block, so during decoding of the genesis block it&#x27;ll be ignored.</p>
</li>
<li>
<p>Once any block produced after genesis becomes <code>CONFIRMATION_DEPTH_K</code>-deep, it is included in the <em>recorded history</em>. Recorded history is added to a buffer of capacity <code>RECORDED_HISTORY_SEGMENT_SIZE</code>.</p>
</li>
<li>
<p>When added to the buffer, blocks are turned into <code>SegmentItem</code>s.</p>
</li>
<li>
<p>Each segment will have parent <code>segment_header</code> included as the first item. Each <code>segment_header</code> includes hash of the previous segment header and the segment commitment of the previous segment. Together segment headers form a chain that is used for quick and efficient verification that some <code>piece</code> corresponds to the actual archival history of the blockchain.</p>
</li>
<li>
<p>Segment items are combined into segments. Each segment contains at least two of the following <code>SegmentItem</code>s, in this order:</p>
<ol>
<li>The previous segment’s <code>SegmentHeader</code></li>
<li><code>BlockContinuation</code>, if remained from the previous segment</li>
<li><code>Block</code>(s), as many as fit fully into the current segment, may be none</li>
<li><code>BlockStart</code>, if the next block doesn&#x27;t fit within the current segment</li>
<li><code>Padding</code> (zero or more) in case padding bytes are necessary to complete the segment to <code>RECORDED_HISTORY_SEGMENT_SIZE</code></li>
</ol>
</li>
<li>
<p>When the buffer (after SCALE-encode) contains enough data to fill a record of <code>RAW_RECORD_SIZE</code> bytes, it is archived:</p>
<ol>
<li>Split the record into  <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi></mrow><annotation encoding="application/x-tex">d</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em"></span><span class="mord mathnormal">d</span></span></span></span> = <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>2</mn><mn>15</mn></msup></mrow><annotation encoding="application/x-tex">2^{15}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141em"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em"><span style="top:-3.063em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">15</span></span></span></span></span></span></span></span></span></span></span></span>=<code>NUM_CHUNKS</code> chunks of size <code>SAFE_BYTES</code>.</li>
<li>Interpolate a <code>polynomial</code> over the chunks of the record with <code>poly(record)</code>.</li>
<li>Commit to the record polynomial under KZG and obtain the source <code>record_commitment</code> <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>C</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">C_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span></span> as <code>Commit(polynomial)</code>. This will allow us to later compute proofs that a chunk belongs to a particular record.</li>
</ol>
</li>
<li>
<p>Once <code>NUM_RAW_RECORDS</code> (128) records have been committed, stack them into a matrix of <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>=</mo></mrow><annotation encoding="application/x-tex">n =</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span></span></span></span> <code>NUM_RAW_RECORDS</code> rows and <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi></mrow><annotation encoding="application/x-tex">d</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em"></span><span class="mord mathnormal">d</span></span></span></span> columns. Each row is a record.</p>
</li>
<li>
<p><strong>Erasure code records</strong> column-wise with <code>extend(column, ERASURE_CODING_RATE)</code></p>
<p>This effectively doubles the number of rows and thus, records per segment to <code>NUM_PIECES</code> (256).</p>
</li>
<li>
<p><strong>Erasure code commitments</strong> with <code>extend(record_commitments, ERASURE_CODING_RATE)</code>.</p>
<div class="collapsible"><button class="collapsible-toggle">►<!-- --> <!-- -->Note</button><div class="collapsible-content"><p>By doing this step we can effectively save almost half of the record commitment time in archival. Instead of directly committing to parity records we erasure code the commitments here, which should match the parity record commitments, but being much faster to compute.</p></div></div>
</li>
<li>
<p>Hash each <code>record_commitment</code>, both source and parity, into 254-bit scalar <code>record_commitment_hash</code>es values <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>h</mi><mn>0</mn></msub><mo>…</mo><msub><mi>h</mi><mrow><mn>2</mn><mi>n</mi></mrow></msub></mrow><annotation encoding="application/x-tex">h_0…h_{2n}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em"></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em"></span><span class="minner">…</span><span class="mspace" style="margin-right:0.1667em"></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span></span>.</p>
<div class="collapsible"><button class="collapsible-toggle">►<!-- --> <!-- -->Note</button><div class="collapsible-content"><p>Commitments are hashed to 254 bits (we hash it as usual and set last 2 bits to 0) to bring them back down to field elements so it becomes possible to KZG commit to them (at cost of losing homomorphic properties). There is no direct way to commit to 48-byte KZG commitments without greatly increasing proof size and computation time (i.e. by using IPP proofs). Committing to the hashes effectively makes a one level Verkle tree.</p></div></div>
</li>
<li>
<p>Interpolate a polynomial <code>segment_polynomial</code> over these hashes and commit to it under KZG to get the <code>segment_commitment</code> <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>C</mi><mi>s</mi></msub></mrow><annotation encoding="application/x-tex">C_s</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">s</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span></span> as <code>commit(Poly(record_commitment_hashes))</code>.</p>
</li>
<li>
<p>For each <code>record_commitment_hashes[i]</code> <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>h</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">h_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em"></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span></span>, compute a <code>record_witness</code> <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>π</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">\pi_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em">π</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span></span> to the <code>segment_commitment</code> <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>C</mi><mi>s</mi></msub></mrow><annotation encoding="application/x-tex">C_s</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">s</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span></span> as <code>create_witness(segment_polynomial, i)</code>.</p>
<p>This will allow us to prove that a record belongs to an archived history segment without having to provide all other segment commitments at a cost of storing additional 48 bytes per piece.</p>
</li>
<li>
<p>For each record, form a <code>piece = record || record_commitment || record_witness</code> <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><msub><mi>r</mi><mi>i</mi></msub><mi mathvariant="normal">∣</mi><mi mathvariant="normal">∣</mi><msub><mi>C</mi><mi>i</mi></msub><mi mathvariant="normal">∣</mi><mi mathvariant="normal">∣</mi><msub><mi>π</mi><mi>i</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(r_i||C_i|| \pi_i)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mord">∣∣</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mord">∣∣</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em">π</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></p>
</li>
<li>
<p>Append the <code>segment_commitment</code> to the global <code>segment_commitments[]</code> table of the chain.</p>
</li>
<li>
<p>The segment now consists of <code>NUM_PIECES</code> records of 1MiB each, <code>NUM_PIECES</code> piece commitments, <code>NUM_PIECES</code> proofs of 48 bytes each and one 48-byte <code>segment_commitment</code>.</p>
<p>The pieces with even indices ((0, 2, …, 254) of this segment) correspond to source records and the pieces with odd indices ((1, 3, …, 255)of this segment) correspond to parity records. The blockchain history data is effectively contained only in pieces with an even <code>piece_index</code>.</p>
</li>
</ol>
<p><img decoding="async" loading="lazy" alt="Figure 3: Piece Building Process corresponds to steps 5-12 of Archiving." src="/protocol-specs/assets/images/Archiving_Process-ead92efc6563ef5e73c8fd864d72abc7.png" width="1530" height="1330" class="img_ev3q"></p>
<center>Figure 3: Piece Building Process corresponds to steps 5-12 of Archiving.</center>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="plotting">Plotting<a href="#plotting" class="hash-link" aria-label="Direct link to Plotting" title="Direct link to Plotting">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="pre-plotting-initialization">Pre-plotting Initialization<a href="#pre-plotting-initialization" class="hash-link" aria-label="Direct link to Pre-plotting Initialization" title="Direct link to Pre-plotting Initialization">​</a></h3>
<p><em><strong>Determining and retrieving the assigned portion of the history</strong></em></p>
<ol>
<li>
<p>Given the total allocated disk space, reserve some space (<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>&lt;</mo><mn>2</mn><mi mathvariant="normal">%</mi></mrow><annotation encoding="application/x-tex">&lt;2\%</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:0.8056em;vertical-align:-0.0556em"></span><span class="mord">2%</span></span></span></span>) for commitments and other auxiliary information.</p>
</li>
<li>
<p>Create a single plot of <code>plot_size = allocated_plotting_space</code>. Sizes of farmer plots are independent from size of blockchain history, but must be a multiple of <code>sector_size</code>.</p>
</li>
<li>
<p>Generate a farmer identity, that is a key pair <code>public_key, secret_key</code> under the digital signature scheme. These signing keys are independent from reward address of an entity (exactly as payout address in Bitcoin mining) described in <a href="/protocol-specs/docs/consensus/consensus_chain#block-reward-address">Block reward address</a>.</p>
</li>
<li>
<p>Derive an identifier <code>public_key_hash</code> as <code>hash(public_key)</code>. This farmer id will also serve as the basis for their single global network peer id in the DHT.</p>
</li>
<li>
<p>Determine the <code>sector_count = plot_size / sector_size</code>.</p>
</li>
<li>
<p><strong>Verifiable Sector Construction (VSC)</strong>:</p>
<p>Determine which pieces are to be downloaded for this sector:</p>
<ol>
<li>Index the sectors sequentially and for each sector derive <code>sector_id = keyed_hash(public_key_hash, sector_index || history_size)</code>, where <code>sector_index</code> is the sector index in the plot and <code>history_size</code> is the current history size at the time of sector creation.</li>
<li>For each sector, for each <code>piece_offset</code> in <code>0..max_pieces_in_sector</code>, derive the <code>piece_index</code> in global blockchain history this slot will contain, as follows:<!-- -->
<ol>
<li>At the start of the chain, if <code>history_size &lt;= RECENT_SEGMENTS / RECENT_HISTORY_FRACTION</code> the pieces for this sector are selected uniformly as <code>piece_index = keyed_hash(piece_offset, sector_id) mod (history_size * NUM_PIECES)</code> for <code>piece_offset</code> in <code>0..max_pieces_in_sector</code></li>
<li>Later, when history grows (<code>history_size &gt; RECENT_SEGMENTS / RECENT_HISTORY_FRACTION</code>) to make sure recent archived history is plotted on farmer storage as soon as possible we select <code>RECENT_HISTORY_FRACTION</code> of pieces for each sector from the last <code>RECENT_SEGMENTS</code> archived segments.</li>
<li>For <code>piece_offset</code> in <code>0..max_pieces_in_sector * RECENT_HISTORY_FRACTION * 2</code>:<!-- -->
<ol>
<li>If <code>piece_offset</code> is odd, select a piece from recent history as <code>piece_index = keyed_hash(piece_offset, sector_id) mod (RECENT_SEGMENTS * NUM_PIECES) + ((history_size - RECENT_SEGMENTS) * NUM_PIECES)</code></li>
<li>If <code>piece_offset</code> is even, select a piece uniformly from all history as <code>piece_index = keyed_hash(piece_offset, sector_id) mod (history_size * NUM_PIECES)</code></li>
</ol>
</li>
<li>The rest of the pieces for this sector are selected uniformly as <code>piece_index = keyed_hash(piece_offset, sector_id) mod (history_size * NUM_PIECES)</code> for <code>piece_offset</code> in <code>(2 * RECENT_HISTORY_FRACTION * max_pieces_in_sector)..max_pieces_in_sector</code></li>
</ol>
</li>
<li>Retain the <code>history_size</code> count at the time of sector creation. This sector will expire at a point in the future as described in <a href="#sector-expiration">Sector Expiration</a>.</li>
</ol>
</li>
<li>
<p>Retrieve each piece from the Distributed Storage Network (DSN) and verify against segment commitment obtained from the node.</p>
</li>
</ol>
<div align="center"><p><img decoding="async" loading="lazy" alt="Raw Sector Light" src="/protocol-specs/assets/images/Raw_Sector-light-c3428c90bd0af662e08f3a55da08c834.svg#gh-light-mode-only" width="1035" height="387" class="img_ev3q">
<img decoding="async" loading="lazy" alt="Raw Sector Dark" src="/protocol-specs/assets/images/Raw_Sector-dark-586eb4971febf315af3cfba9c5f6809c.svg#gh-dark-mode-only" width="1035" height="387" class="img_ev3q"></p></div>
<center>Figure 4: Verifiable Sector Construction.</center>
<br>
<ol start="8">
<li>For each synced sector, proceed to <a href="#plotting">Plotting</a> phase.</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="plotting-to-disk">Plotting to Disk<a href="#plotting-to-disk" class="hash-link" aria-label="Direct link to Plotting to Disk" title="Direct link to Plotting to Disk">​</a></h3>
<p><em><strong>Sealing the history</strong></em></p>
<p>For each sector, given that all pieces assigned to the sector reside locally in memory, encode pieces row-wise (piece by piece or one piece at a time).</p>
<p>For each piece in the sector:</p>
<ol>
<li>
<p>Extract the bundled record from the piece and retain the <code>record_witness</code> and  <code>record_commitment</code> alongside the plot.</p>
</li>
<li>
<p>Split the extracted record into <code>FULL_BYTES</code>-sized <code>record_chunks</code>, which are guaranteed to contain values that fit into the scalar field.</p>
</li>
<li>
<p>Erasure code the record with <code>extended_chunks = extend(record_chunks, ERASURE_CODING_RATE)</code></p>
<div class="collapsible"><button class="collapsible-toggle">►<!-- --> <!-- -->Implementation Note</button><div class="collapsible-content"><ul>
<li>(Optimization, Implemented) It is faster to do FFT over domain <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>2</mn><mn>16</mn></msup></mrow><annotation encoding="application/x-tex">2^{16}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141em"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em"><span style="top:-3.063em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">16</span></span></span></span></span></span></span></span></span></span></span></span> with <code>extend</code> and throw away all values that are not in <code>proven_indices</code> then evaluate at proven indices. FFT complexity is expected at <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mn>2</mn><mi>n</mi><mi>l</mi><mi>o</mi><mi>g</mi><mo stretchy="false">(</mo><mn>2</mn><mi>n</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mo>≈</mo><msup><mn>2</mn><mn>16</mn></msup><mo>∗</mo><mn>16</mn><mo>=</mo><msup><mn>2</mn><mn>20</mn></msup></mrow><annotation encoding="application/x-tex">O(2nlog(2n)) \approx 2^{16}*16 = 2^{20}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord mathnormal" style="margin-right:0.02778em">O</span><span class="mopen">(</span><span class="mord">2</span><span class="mord mathnormal">n</span><span class="mord mathnormal" style="margin-right:0.01968em">l</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.03588em">g</span><span class="mopen">(</span><span class="mord">2</span><span class="mord mathnormal">n</span><span class="mclose">))</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">≈</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:0.8141em"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em"><span style="top:-3.063em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">16</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:0.6444em"></span><span class="mord">16</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:0.8141em"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em"><span style="top:-3.063em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">20</span></span></span></span></span></span></span></span></span></span></span></span> while direct evaluation is <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><msup><mi>n</mi><mn>2</mn></msup><mo stretchy="false">)</mo><mo>≈</mo><mo stretchy="false">(</mo><msup><mn>2</mn><mn>15</mn></msup><msup><mo stretchy="false">)</mo><mn>2</mn></msup><mo>=</mo><msup><mn>2</mn><mn>30</mn></msup></mrow><annotation encoding="application/x-tex">O(n^2)\approx (2^{15})^2 = 2^{30}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0641em;vertical-align:-0.25em"></span><span class="mord mathnormal" style="margin-right:0.02778em">O</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em"><span style="top:-3.063em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">≈</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:1.0641em;vertical-align:-0.25em"></span><span class="mopen">(</span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em"><span style="top:-3.063em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">15</span></span></span></span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em"><span style="top:-3.063em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:0.8141em"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em"><span style="top:-3.063em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">30</span></span></span></span></span></span></span></span></span></span></span></span></li>
</ul></div></div>
</li>
<li>
<p>Derive an <code>evaluation_seed</code> from <code>sector_id</code> and <code>piece_offset</code> within this sector as <code>evaluation_seed = hash(sector_id || piece_offset)</code></p>
</li>
<li>
<p>Derive a Chia proof-of-space table <code>pos_table = generate(K, evaluation_seed)</code></p>
</li>
<li>
<p>Initialize <code>num_successfully_encoded_chunks = 0</code> to indicate how many chunks were encoded so far.</p>
</li>
<li>
<p>Iterate through each <code>(s_bucket, chunk)</code> in <code>extended_chunks</code>:</p>
<ol>
<li>Query the <code>pos_table</code> for a valid proof-of-space <code>proof_of_space</code> for this chunk as <code>find_proof(pos_table, s_bucket)</code>.</li>
<li>If it exists, encode the current chunk as <code>encode(chunk, hash(proof_of_space))</code> and increase <code>num_successfully_encoded_chunks</code> by 1. Otherwise, continue to the next chunk.</li>
<li>Place the encoded chunk into a corresponding s-bucket for given index <code>s_bucket</code> and set corresponding bit in the <code>encoded_chunks_used</code> bitfield to <code>1</code>.</li>
</ol>
<div class="collapsible"><button class="collapsible-toggle">►<!-- --> <!-- -->Implementation Note</button><div class="collapsible-content"><p>There is one <code>encoded_chunks_used</code> bitfield per record  which indicates which s-buckets contain its encoded chunks.</p></div></div>
</li>
<li>
<p>If <code>num_successfully_encoded_chunks &gt;= NUM_CHUNKS</code> all chunks were encoded successfully, take the necessary <code>NUM_CHUNKS</code> and  proceed to the next record.</p>
</li>
<li>
<p>Else, if <code>num_successfully_encoded_chunks &lt; NUM_CHUNKS</code>, select extra chunks to store at the end after encoded chunks:</p>
<ol>
<li>Compute <code>num_unproven = NUM_CHUNKS - num_successfully_encoded_chunks</code></li>
<li>Save as <code>extra_chunks</code> the first <code>num_unproven</code> chunks of the source record corresponding to the indices where <code>encoded_chunks_used</code> is not set.</li>
</ol>
<div class="collapsible"><button class="collapsible-toggle">►<!-- --> <!-- -->Note</button><div class="collapsible-content"><p>Testing with k=17 showed that the event when <code>pos_table</code> did not contain <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>2</mn><mn>15</mn></msup></mrow><annotation encoding="application/x-tex">2^{15}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141em"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em"><span style="top:-3.063em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">15</span></span></span></span></span></span></span></span></span></span></span></span> proofs within <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>2</mn><mn>16</mn></msup></mrow><annotation encoding="application/x-tex">2^{16}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141em"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em"><span style="top:-3.063em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">16</span></span></span></span></span></span></span></span></span></span></span></span> possible bucket indices, and thus <code>encoded_chunks_used</code> has less than <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>2</mn><mn>15</mn></msup></mrow><annotation encoding="application/x-tex">2^{15}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141em"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em"><span style="top:-3.063em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">15</span></span></span></span></span></span></span></span></span></span></span></span> bits set, happened for ~0.8% records we should retain necessary amount of source chunks for the record to be recoverable and provable. These extra chunks cannot participate in farming though.</p></div></div>
</li>
<li>
<p>Once all records are encoded, write the sector to disk, one s-bucket at time in order of the index, each followed by <code>encoded_chunks_used</code> bitfield corresponding to selected chunks.</p>
</li>
<li>
<p>The final plotted sector consists of <code>max_pieces_in_sector</code> many <code>encoded_chunks_used</code> bitfields of size <code>NUM_S_BUCKETS</code> each,  <code>NUM_S_BUCKETS</code> s-buckets and commitments and witnesses of pieces in this sector.</p>
<p>Each <code>encoded_chunks_used</code> indicator vector has bit set to <code>1</code> at places corresponding to the record positions whose chunks are encoded in this s-bucket and are eligible for farming.</p>
</li>
</ol>
<p><img decoding="async" loading="lazy" alt="Figure 5: Complete Plotting process for an example sector of 4 pieces" src="/protocol-specs/assets/images/Plotting_Process-fa2b9670594216a6f03bad2b9cb20ddd.png" width="2000" height="2162" class="img_ev3q"></p>
<center>Figure 5: Complete Plotting process for an example sector of 4 pieces</center>
<div class="collapsible"><button class="collapsible-toggle">►<!-- --> <!-- -->Implementation Note</button><div class="collapsible-content"><ol>
<li>Plotting consists of transforming raw sectors into encoded sectors, which can be viewed as converting a row-wise matrix of raw records into a row-wise matrix of encoded records and viewing that as a column-wise matrix of s-buckets.</li>
<li>Sectors are written to disk in a manner that is optimized for sector audits (as opposed to efficient recovery of pieces).</li>
</ol></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="sector-expiration">Sector Expiration<a href="#sector-expiration" class="hash-link" aria-label="Direct link to Sector Expiration" title="Direct link to Sector Expiration">​</a></h3>
<p>After <code>MIN_SECTOR_LIFETIME</code> segments were archived (since sector creation), the farmer should check whether the sector have expired and can no longer be farmed based on the “age” (history size at plotting) of each sector.
For each sector <code>sector_id</code> and <code>history_size</code> when this sector was plotted:</p>
<ol>
<li>When current history size of the chain reaches <code>sector_expiration_check_history_size = history_size + MIN_SECTOR_LIFETIME</code> farmer should check when to expire this sector based on corresponding <code>segment_commitment</code> of last archived segment.</li>
<li>Compute <code>sector_max_lifetime = MIN_SECTOR_LIFETIME + 4 * history_size</code>. With this limitation on sector lifetime, a sector with expire with probability ~50% by the time history doubles since it’s initial plotting point and is guaranteed to expire by the time history doubles again.</li>
<li>Compute <code>expiration_history_size = hash(sector_id || segment_commitment) mod (sector_max_lifetime - sector_expiration_check_history_size) + sector_expiration_check_history_size</code></li>
<li>When the current history size reaches <code>expiration_history_size</code>, expire this sector.</li>
<li>Replot the sector for new history size as described in <a href="#plotting">Plotting</a>.</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="farming">Farming<a href="#farming" class="hash-link" aria-label="Direct link to Farming" title="Direct link to Farming">​</a></h2>
<p><em><strong>Auditing the history</strong></em></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="challenge-generation">Challenge Generation<a href="#challenge-generation" class="hash-link" aria-label="Direct link to Challenge Generation" title="Direct link to Challenge Generation">​</a></h3>
<ol>
<li>For each <code>slot_number</code>, compute the <code>global_challenge</code> as <code>hash(global_randomness||slot_number)</code>. The <code>slot_number</code> and <code>global_randomness</code> are derived from PoT (see <a href="/protocol-specs/docs/consensus/proof_of_time#derive_global_randomness">derive_global_randomness</a>).</li>
<li>Compute the <code>sector_slot_challenge = global_challenge XOR sector_id</code></li>
<li>Compute the <code>s_bucket_audit_index = sector_slot_challenge mod NUM_S_BUCKETS</code></li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="audit">Audit<a href="#audit" class="hash-link" aria-label="Direct link to Audit" title="Direct link to Audit">​</a></h3>
<ol>
<li>Read the corresponding s-bucket at <code>s_bucket_audit_index</code> from disk into memory.</li>
<li>For each <code>chunk</code> in the bucket, compute <code>audit_chunk = keyed_hash(sector_slot_challenge, chunk)</code>, truncated to 8 bytes</li>
<li>Check if the result (as integer) falls within +/-<code>voting_solution_range/2</code> of the <code>global_challenge</code></li>
<li>Sort all the potentially winning <code>audit_chunks</code> by their “quality” - the closest to <code>global_challenge</code> first.</li>
<li><a href="#proving">Prove</a> the best chunk and <a href="#submitting-a-solution">submit</a> the solution.</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="proving">Proving<a href="#proving" class="hash-link" aria-label="Direct link to Proving" title="Direct link to Proving">​</a></h3>
<ol>
<li>
<p>For a winning <code>audit_chunk</code> (8 bytes), derive the <code>chunk_offset</code> from the parent full chunk’s position in the <em>s-bucket.</em></p>
</li>
<li>
<p>Get the full 32 byte <code>chunk</code> at that <code>chunk_offset</code>.</p>
</li>
<li>
<p>From <code>encoded_chunks_used</code> bitfields determine if it is an encoded chunk.</p>
</li>
<li>
<p>If not, chunk is not eligible for proving.</p>
</li>
<li>
<p>If yes, then determine parent record <code>piece_offset</code> of this <code>chunk</code>.</p>
</li>
<li>
<p>Compute the steps 1-7 in <a href="#recovering-the-record">Recovering the Record</a> and obtain <code>plotted_chunks</code></p>
</li>
<li>
<p>Save the <code>proof_of_space</code> for this <code>chunk</code> used for decoding</p>
</li>
<li>
<p>Recover the <code>extended_chunks_poly</code> using decoded chunks with <code>recover_poly(plotted_chunks)</code>.</p>
</li>
<li>
<p>Retrieve the <code>record_commitment</code>.</p>
</li>
<li>
<p>Compute the <code>chunk_witness</code> for the decoded winning <code>chunk</code> that ties back to the <code>record_commitment</code> as <code>create_witness(extended_chunks_poly, s_bucket_audit_index)</code>, and attach both to the solution for verification against the original record commitment stored in the history.</p>
</li>
<li>
<p>Retrieve the <code>record_witness</code> that ties back to the <code>segment_commitment</code>.</p>
</li>
<li>
<p>Produce a <code>solution</code> consisting of</p>
<div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">struct</span><span class="token plain"> </span><span class="token type-definition class-name">Solution</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">	public_key</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain">          </span><span class="token number">32</span><span class="token plain"> bytes</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">	reward_address</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain">      </span><span class="token number">32</span><span class="token plain"> bytes</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">	sector_index</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain">         </span><span class="token number">2</span><span class="token plain"> bytes</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">	history_size</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain">         </span><span class="token number">8</span><span class="token plain"> bytes</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">	piece_offset</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain">         </span><span class="token number">2</span><span class="token plain"> bytes</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">	record_commitment</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain">   </span><span class="token number">48</span><span class="token plain"> bytes</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">	record_witness</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain">      </span><span class="token number">48</span><span class="token plain"> bytes</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">	chunk</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain">               </span><span class="token number">32</span><span class="token plain"> bytes</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">	chunk_witness</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain">       </span><span class="token number">48</span><span class="token plain"> bytes</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">	proof_of_space</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain">     </span><span class="token number">160</span><span class="token plain"> bytes</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="submitting-a-solution">Submitting a solution<a href="#submitting-a-solution" class="hash-link" aria-label="Direct link to Submitting a solution" title="Direct link to Submitting a solution">​</a></h3>
<p>If the winning <code>audit_chunk</code> is within <code>solution_range</code>:</p>
<ol>
<li>Attach <code>solution</code> to block header.</li>
<li>Forge a new <code>block</code> (as defined in Substrate framework).</li>
<li>Seal the <code>block</code> content with <code>sign(secret_key, block)</code>.</li>
</ol>
<p>Otherwise, submit a vote extrinsic with <code>solution</code>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="verification">Verification<a href="#verification" class="hash-link" aria-label="Direct link to Verification" title="Direct link to Verification">​</a></h2>
<p><em><strong>Ensuring a solution comes from a valid plot</strong></em></p>
<ol>
<li>If the <code>public_key</code> of the block&#x27;s farmer is in the block list, ignore the block.</li>
<li>Verify that the consensus log in the block header is correct. This includes <code>solution_range</code> and <code>global_randomness</code>.</li>
<li>Verify that PoT items in the header are correct according to <a href="/protocol-specs/docs/consensus/proof_of_time#new-blocks">New Blocks</a></li>
<li>Verify that <code>solution_range</code> and <code>global_randomness</code> are correct for the <code>slot_number</code> of the block.</li>
<li>Compute the <code>global_challenge = hash(global_randomness||slot_number)</code>.</li>
<li>Verify that current chain history size in segments is greater than winning <code>piece_index / NUM_PIECES</code>.</li>
<li>Verify that <code>piece_offset ≤ max_pieces_in_sector</code></li>
<li>Re-derive <code>sector_id</code>
<ol>
<li>Compute <code>public_key_hash = hash(public_key)</code></li>
<li>Re-derive the <code>sector_id = keyed_hash(public_key_hash, sector_index || history_size)</code></li>
</ol>
</li>
<li>Verify that the <code>sector_id</code> submitted has not expired:<!-- -->
<ol>
<li>Compute <code>sector_expiration_check_history_size = history_size + MIN_SECTOR_LIFETIME</code> and <code>sector_max_lifetime = MIN_SECTOR_LIFETIME + 4 * history_size</code>.</li>
<li>Take the archived segment <code>segment_commitment</code> at <code>sector_expiration_check_history_size</code>.</li>
<li>Compute <code>expiration_history_size = hash(sector_id||segment_commitment) mod (sector_max_lifetime - sector_expiration_check_history_size) + sector_expiration_check_history_size</code></li>
<li>Check that <code>expiration_history_size</code> is smaller than current history size of the chain.</li>
</ol>
</li>
<li>Re-derive the <code>sector_slot_challenge = global_challenge XOR sector_id</code></li>
<li>Re-derive the <code>s_bucket_audit_index = sector_slot_challenge mod NUM_S_BUCKETS</code></li>
<li>Re-derive the <code>evaluation_seed</code> for the record from the <code>sector_id</code> and <code>piece_offset</code> as <code>hash(sector_id || piece_offset)</code></li>
<li>Verify <code>proof_of_space</code> with <code>Is_Proof_Valid(K, evaluation_seed, s_bucket_audit_index, proof_of_space)</code></li>
<li>Ensure the <code>chunk</code> satisfies the challenge criteria:<!-- -->
<ol>
<li>Compute the <code>masked_chunk</code> as <code>Encode(chunk, hash(proof_of_space))</code></li>
<li>Compute the keyed hash <code>keyed_hash(sector_slot_challenge, masked_chunk)</code> truncated to <code>audit_chunk</code> size</li>
<li>Ensure the result falls within +/- <code>solution_range/2</code> of the <code>global_challenge</code></li>
</ol>
</li>
<li>Ensure the provided <code>chunk</code> was correctly extended from a history piece for the assigned record commitment:<!-- -->
<ol>
<li>Verify the <code>chunk_witness</code> for the given <code>chunk</code>, <code>record_commitment</code>, and <code>s_bucket_audit_index</code></li>
</ol>
</li>
<li>Ensure the encoded record belongs to the assigned slot and that record also belongs to the history:<!-- -->
<ol>
<li>Re-derive the <code>piece_index</code> from the <code>piece_offset</code> and <code>history_size</code> the same way as during <a href="#pre-plotting-initialization">pre-plotting</a> (as described in Verifiable Sector Construction)</li>
<li>Retrieve the <code>segment_commitment</code> of the segment that contains the assigned <code>piece_index</code></li>
<li>Hash the <code>record_commitment</code> to obtain the <code>record_commitment_hash</code></li>
<li>Verify the <code>record_witness</code> for the <code>piece_index</code> , <code>record_commitment_hash</code> and <code>segment_commitment</code></li>
</ol>
</li>
<li>Ensure the farmer did not outsource solving to a third-party without revealing their private keys by verifying the <code>farmer_signature</code> with the <code>public_key</code> and <code>chunk</code>.</li>
<li>Verify the signature on the block content.</li>
<li>If another block signed with the solution with same solution (<code>public_key</code>, <code>sector_index</code>, <code>piece_offset</code>,<code>chunk</code>, <code>chunk_audit_index</code> and <code>slot_number</code>) had already been received, report an equivocation by <code>public_key</code> and ignore the block.</li>
</ol>
<p>The above steps assume standard block and transaction verification.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="extraction">Extraction<a href="#extraction" class="hash-link" aria-label="Direct link to Extraction" title="Direct link to Extraction">​</a></h2>
<p><em><strong>Serving data from the plot</strong></em></p>
<ol>
<li>When requested a piece at <code>piece_index</code> identify <code>sector_index</code> and <code>piece_offset</code> where that piece is stored.</li>
<li>For the record plotted at <code>piece_offset</code> in that sector perform record recovery and compose the piece.</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="recovering-the-record">Recovering the Record<a href="#recovering-the-record" class="hash-link" aria-label="Direct link to Recovering the Record" title="Direct link to Recovering the Record">​</a></h3>
<ol>
<li>From the record’s <code>encoded_chunks_used</code> bitfield determine which s-buckets contain chunks of this record.</li>
<li>Read all the <code>plotted_chunks</code> of the parent record from their respective s-buckets. Set the encoded chunk value <code>None</code> in places where <code>encoded_chunks_used</code> is <code>0</code>.
Total length of <code>plotted_chunks</code> should be <code>NUM_CHUNKS/ERASURE_CODING_RATE</code>.</li>
<li>Derive the <code>evaluation_seed</code> for the record from <code>sector_id</code> and <code>piece_offset</code> within this sector as <code>evaluation_seed = hash(sector_id || piece_offset)</code></li>
<li>Derive a Chia proof-of-space table <code>pos_table = generate(K, evaluation_seed)</code></li>
<li>Iterate through each <code>(s_bucket, plotted_chunk)</code> in <code>plotted_chunks</code>:<!-- -->
<ol>
<li>If <code>plotted_chunk</code> is <code>None</code>, continue to next chunk.</li>
<li>Else, query the <code>pos_table</code> for a valid proof-of-space<code>proof_of_space</code> for this chunk as <code>find_proof(pos_table, s_bucket)</code>. The proof should exist if the chunk was encoded and plotted.</li>
<li>Decode the chunk in-place with <code>decode(plotted_chunk, hash(proof_of_space))</code>.</li>
</ol>
</li>
<li>If the number of <code>plotted_chunks</code> is less then <code>NUM_CHUNKS</code>, we need extra chunks to recover the record. Insert each <code>extra_chunk</code> in places of <code>None</code> in <code>plotted_chunks</code> from the beginning, however many extra chunks there are.</li>
<li>Recover the source <code>record</code> from the decoded chunks with <code>recover(plotted_chunks))</code>.</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="composing-the-piece">Composing the Piece<a href="#composing-the-piece" class="hash-link" aria-label="Direct link to Composing the Piece" title="Direct link to Composing the Piece">​</a></h3>
<ol>
<li>Retrieve the <code>record_commitment</code> and <code>record_witness</code> from the sector table.</li>
<li>Return the recovered piece as <code>record || record_commitment || record_witness</code>.</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="randomness-updates">Randomness Updates<a href="#randomness-updates" class="hash-link" aria-label="Direct link to Randomness Updates" title="Direct link to Randomness Updates">​</a></h2>
<p>Global randomness is updated every slot with the output of Proof-of-Time chain for that slot. See <a href="/protocol-specs/docs/consensus/proof_of_time">Proof-of-Time Specification</a>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="solution-range-updates">Solution Range Updates<a href="#solution-range-updates" class="hash-link" aria-label="Direct link to Solution Range Updates" title="Direct link to Solution Range Updates">​</a></h2>
<p>Initial solution range <code>INITIAL_SOLUTION_RANGE</code> is computed based on a single plotted sector with the goal of getting a single winning chunk in each slot with probability <code>SLOT_PROBABILITY</code>, as follows:</p>
<p>Let <code>num_audit_chunks</code> be the number of tickets read during single slot audit in a sector. For each piece (<code>max_pieces_in_sector</code>), we audit a single full chunk in a single s-bucket. The probability of s-bucket containing a full chunk at that position is <code>NUM_CHUNKS/NUM_S_BUCKETS</code> (1/2). Thus, a farmer has this many tickets at each slot:</p>
<span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mtext>num_chunks</mtext><mo>=</mo><mtext>max_pieces_in_sector</mtext><mo>∗</mo><mfrac><mtext>NUM_CHUNKS</mtext><mtext>NUM_S_BUCKETS</mtext></mfrac></mrow><annotation encoding="application/x-tex">\text{num\_chunks} = \text{max\_pieces\_in\_sector}*\frac{\text{NUM\_CHUNKS}}{\text{NUM\_S\_BUCKETS}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0044em;vertical-align:-0.31em"></span><span class="mord text"><span class="mord">num_chunks</span></span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:0.9779em;vertical-align:-0.31em"></span><span class="mord text"><span class="mord">max_pieces_in_sector</span></span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:2.3793em;vertical-align:-0.996em"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3833em"><span style="top:-2.314em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord text"><span class="mord">NUM_S_BUCKETS</span></span></span></span><span style="top:-3.23em"><span class="pstrut" style="height:3em"></span><span class="frac-line" style="border-bottom-width:0.04em"></span></span><span style="top:-3.7em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord text"><span class="mord">NUM_CHUNKS</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.996em"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span>
<p>To compute initial solution range for one sector, maximum possible solution range (<code>U64::MAX</code>) is divided by <code>num_chunks</code> and multiplied by slot probability:</p>
<span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mfrac><mtext>U64::MAX</mtext><mtext>num_chunks</mtext></mfrac><mo>∗</mo><mtext>SLOT_PROBABILITY</mtext></mrow><annotation encoding="application/x-tex">\frac{\text{U64::MAX}}{\text{num\_chunks}}*\text{SLOT\_PROBABILITY} </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.3563em;vertical-align:-0.996em"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3603em"><span style="top:-2.314em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord text"><span class="mord">num_chunks</span></span></span></span><span style="top:-3.23em"><span class="pstrut" style="height:3em"></span><span class="frac-line" style="border-bottom-width:0.04em"></span></span><span style="top:-3.677em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord text"><span class="mord">U64::MAX</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.996em"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:0.9933em;vertical-align:-0.31em"></span><span class="mord text"><span class="mord">SLOT_PROBABILITY</span></span></span></span></span></span>
<p><code>INITIAL_SOLUTION_RANGE</code> becomes <code>solution_range</code> for the first <strong>era</strong>.</p>
<p>Global <code>solution_range</code> is adjusted every era accordingly to actual and expected blocks produced per era to keep block production at the same pace while space pledged on the network change:</p>
<ol>
<li>After every <code>ERA_DURATION_IN_BLOCKS</code> number of blocks, a new era begins.</li>
<li>At the start of a new era, compute and store new <code>solution_range</code></li>
</ol>
<p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>next_solution_range</mtext><mo>=</mo><mi>max</mi><mo>⁡</mo><mrow><mo fence="true">(</mo><mi>min</mi><mo>⁡</mo><mrow><mo fence="true">(</mo><mfrac><mtext>era_slot_count</mtext><mtext>ERA_DURATION_IN_BLOCKS</mtext></mfrac><mo>∗</mo><mtext>SLOT_PROBABILITY</mtext><mo separator="true">,</mo><mn>4</mn><mo fence="true">)</mo></mrow><mo separator="true">,</mo><mn>1</mn><mi mathvariant="normal">/</mi><mn>4</mn><mo fence="true">)</mo></mrow><mo>∗</mo><mtext>solution_range</mtext></mrow><annotation encoding="application/x-tex">\text{next\_solution\_range} = \max\left(\min\left(\frac{\text{era\_slot\_count}}{\text{ERA\_DURATION\_IN\_BLOCKS}}*\text{SLOT\_PROBABILITY}, 4\right), 1/4\right)*\text{solution\_range}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0044em;vertical-align:-0.31em"></span><span class="mord text"><span class="mord">next_solution_range</span></span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:1.8em;vertical-align:-0.65em"></span><span class="mop">max</span><span class="mspace" style="margin-right:0.1667em"></span><span class="minner"><span class="mopen delimcenter" style="top:0em"><span class="delimsizing size2">(</span></span><span class="mop">min</span><span class="mspace" style="margin-right:0.1667em"></span><span class="minner"><span class="mopen delimcenter" style="top:0em"><span class="delimsizing size2">(</span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0131em"><span style="top:-2.655em"><span class="pstrut" style="height:3em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">ERA_DURATION_IN_BLOCKS</span></span></span></span></span><span style="top:-3.23em"><span class="pstrut" style="height:3em"></span><span class="frac-line" style="border-bottom-width:0.04em"></span></span><span style="top:-3.527em"><span class="pstrut" style="height:3em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">era_slot_count</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.562em"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mord text"><span class="mord">SLOT_PROBABILITY</span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em"></span><span class="mord">4</span><span class="mclose delimcenter" style="top:0em"><span class="delimsizing size2">)</span></span></span><span class="mspace" style="margin-right:0.1667em"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em"></span><span class="mord">1/4</span><span class="mclose delimcenter" style="top:0em"><span class="delimsizing size2">)</span></span></span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:1.0044em;vertical-align:-0.31em"></span><span class="mord text"><span class="mord">solution_range</span></span></span></span></span>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="conversion-rate-between-solution-range-and-space-pledged">Conversion Rate Between Solution Range and Space Pledged<a href="#conversion-rate-between-solution-range-and-space-pledged" class="hash-link" aria-label="Direct link to Conversion Rate Between Solution Range and Space Pledged" title="Direct link to Conversion Rate Between Solution Range and Space Pledged">​</a></h3>
<p>The relationship between the solution range and the amount of space pledged is dynamically calculated using the function <code>solution_range_to_sectors</code>. This function computes the number of sectors corresponding to a given solution range by adjusting for slot probability and the configuration of data within sectors. Specifically, the maximum possible solution range (<code>SolutionRange::MAX</code>) is first reduced according to the slot probability, which reflects the desired frequency of successful block production. This is further adjusted by the distribution of data, particularly the ratio of the number of chunks per s-bucket in each sector (<code>MAX_PIECES_IN_SECTOR * Record::NUM_CHUNKS / Record::NUM_S_BUCKETS</code>), to account for the probability of an occupied s-bucket being successfully audited in the verification process. The resulting figure is then divided by the current solution range to determine the total number of sectors that this solution range can effectively cover.</p>
<div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:rgb(80, 250, 123)">solution_range_to_sectors</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">solution_range</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token class-name">SolutionRange</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">u64</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">let</span><span class="token plain"> sectors </span><span class="token operator">=</span><span class="token plain"> </span><span class="token class-name">SolutionRange</span><span class="token punctuation" style="color:rgb(248, 248, 242)">::</span><span class="token constant" style="color:rgb(189, 147, 249)">MAX</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)">// Account for slot probability</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token operator">/</span><span class="token plain"> </span><span class="token constant" style="color:rgb(189, 147, 249)">SLOT_PROBABILITY</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token number">1</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain"> </span><span class="token constant" style="color:rgb(189, 147, 249)">SLOT_PROBABILITY</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token number">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)">// Now take sector size and probability of hitting occupied s-bucket in sector into account</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token operator">/</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token constant" style="color:rgb(189, 147, 249)">MAX_PIECES_IN_SECTOR</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">u64</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain"> </span><span class="token class-name">Record</span><span class="token punctuation" style="color:rgb(248, 248, 242)">::</span><span class="token constant" style="color:rgb(189, 147, 249)">NUM_CHUNKS</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">u64</span><span class="token plain"> </span><span class="token operator">/</span><span class="token plain"> </span><span class="token class-name">Record</span><span class="token punctuation" style="color:rgb(248, 248, 242)">::</span><span class="token constant" style="color:rgb(189, 147, 249)">NUM_S_BUCKETS</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">u64</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)">// Take solution range into account</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    sectors </span><span class="token operator">/</span><span class="token plain"> solution_range</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/protocol-specs/docs/consensus/consensus_chain"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Consensus Chain</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/protocol-specs/docs/consensus/proof_of_space"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Proof-of-Space</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#public-parameters-and-values" class="table-of-contents__link toc-highlight">Public Parameters and Values</a><ul><li><a href="#protocol-constants" class="table-of-contents__link toc-highlight">Protocol Constants</a></li><li><a href="#dynamic-blockchain-values" class="table-of-contents__link toc-highlight">Dynamic Blockchain Values</a></li><li><a href="#consensus-parameters" class="table-of-contents__link toc-highlight">Consensus Parameters</a></li></ul></li><li><a href="#archiving" class="table-of-contents__link toc-highlight">Archiving</a></li><li><a href="#plotting" class="table-of-contents__link toc-highlight">Plotting</a><ul><li><a href="#pre-plotting-initialization" class="table-of-contents__link toc-highlight">Pre-plotting Initialization</a></li><li><a href="#plotting-to-disk" class="table-of-contents__link toc-highlight">Plotting to Disk</a></li><li><a href="#sector-expiration" class="table-of-contents__link toc-highlight">Sector Expiration</a></li></ul></li><li><a href="#farming" class="table-of-contents__link toc-highlight">Farming</a><ul><li><a href="#challenge-generation" class="table-of-contents__link toc-highlight">Challenge Generation</a></li><li><a href="#audit" class="table-of-contents__link toc-highlight">Audit</a></li><li><a href="#proving" class="table-of-contents__link toc-highlight">Proving</a></li><li><a href="#submitting-a-solution" class="table-of-contents__link toc-highlight">Submitting a solution</a></li></ul></li><li><a href="#verification" class="table-of-contents__link toc-highlight">Verification</a></li><li><a href="#extraction" class="table-of-contents__link toc-highlight">Extraction</a><ul><li><a href="#recovering-the-record" class="table-of-contents__link toc-highlight">Recovering the Record</a></li><li><a href="#composing-the-piece" class="table-of-contents__link toc-highlight">Composing the Piece</a></li></ul></li><li><a href="#randomness-updates" class="table-of-contents__link toc-highlight">Randomness Updates</a></li><li><a href="#solution-range-updates" class="table-of-contents__link toc-highlight">Solution Range Updates</a><ul><li><a href="#conversion-rate-between-solution-range-and-space-pledged" class="table-of-contents__link toc-highlight">Conversion Rate Between Solution Range and Space Pledged</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Subspace Network</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://subspace.network" target="_blank" rel="noopener noreferrer" class="footer__link-item">Official Website<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/subspace/subspace-desktop" target="_blank" rel="noopener noreferrer" class="footer__link-item">Subspace Desktop<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://polkadot.js.org/apps/?rpc=wss%3A%2F%2Ftest-rpc.subspace.network#/explorer" target="_blank" rel="noopener noreferrer" class="footer__link-item">Subspace Explorer<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://testnet-relayer.subspace.network/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Subspace Relayer<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/subspace" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discord.gg/subspace-network" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://t.me/subspace_network" target="_blank" rel="noopener noreferrer" class="footer__link-item">Telegram<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Social</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.youtube.com/channel/UCojYRCZOtVTJHJXivOYJzeQ" target="_blank" rel="noopener noreferrer" class="footer__link-item">YouTube<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.linkedin.com/company/subspace-blockchain" target="_blank" rel="noopener noreferrer" class="footer__link-item">LinkedIn<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/network_subspace" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://medium.com/subspace-network" target="_blank" rel="noopener noreferrer" class="footer__link-item">Medium<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://app.subsocial.network/@NetworkSubspace" target="_blank" rel="noopener noreferrer" class="footer__link-item">Subsocial<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://subspace.network" rel="noopener noreferrer" class="footerLogoLink_BH7S"><img src="/protocol-specs/img/banner-black.svg" alt="Subspace Labs Banner Logo" class="footer__logo themedComponent_mlkZ themedComponent--light_NVdE"><img src="/protocol-specs/img/banner-white.svg" alt="Subspace Labs Banner Logo" class="footer__logo themedComponent_mlkZ themedComponent--dark_xIcU"></a></div><div class="footer__copyright">Copyright © 2025 Subspace Labs, Inc.</div></div></div></footer></div>
</body>
</html>